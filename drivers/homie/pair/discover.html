<link rel="stylesheet" type="text/css" href="../../../assets/styles.css" />
<script src='../../../assets/vue.min.js'></script>
<script src='../../../assets/lodash.min.js'></script>
<script>
    Homey.setTitle(__('pair.title.discovery'));
    new Vue({
        el: '#homie_discovery',
        data: {
            homieDevice: undefined,
            devices: undefined,
        },
        methods: {
            onDevice(device) {
                console.log(device);
                if (!this.devices) {
                    this.devices = {};
                }
                if (device && device.id) {
                    Vue.set(this.devices, device.id, device);
                }
            }
        },
        watch: {
        },
        mounted() {
            Homey.on('detected', device => this.homieDevice = device);
            Homey.on('device', this.onDevice.bind(this));
        }
    });
</script>

<div id="homie_discovery">

    <div v-if="!devices && !homieDevice" class="waiting">
        <p>{{__('pair.discovery.waiting')}}</p>
        <div class="loader">
            <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
                <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z" />
                <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z">
                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="0.5s" repeatCount="indefinite" />
                </path>
            </svg>
        </div>
    </div>

    <div v-if="homieDevice" class="homie-device settings">
        <span>{{__('pair.discovery.found')}}: <b>{{homieDevice}}</b></span>
    </div>
    <div v-if="devices" class="devices settings">
        <div class="homie-node" v-for="(node, nodeId) in devices" style="margin:10px 0;">
            <h1 style="display:inline;font-weight:bold">{{node.name}}</h1> - <span>{{node.type}}</span>
            <div class="capabilities">
                <div class="capability" v-for="(property, propertyId) in node.properties" style="margin:5px 0;">
                    <h2 style="display:inline;font-weight:bold">{{property.name}}</h2>
                    <div><b>id</b>: {{property.id}}</div>
                    <div><b>gettable</b>: {{property.gettable ? 'YES' : 'NO'}}</div>
                    <div><b>settable</b>: {{property.settable ? 'YES' : 'NO'}}</div>
                    <div v-if="property.capability">
                        <b>match</b>: {{property.capability.title.en}} ({{property.capability.id}})
                    </div>
                </div>
            </div>

        </div>
    </div>
    
</div>
